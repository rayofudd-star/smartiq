<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartIQ Pro – Free Interactive IQ Test & Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Take the SmartIQ Pro IQ test – interactive, realistic, and fun, with global score comparisons, daily streaks, instant explanations, and the world's best IQ resources." />
  <meta name="theme-color" content="#1d70e1" />
  <style>
    html { box-sizing: border-box; }
    *, *:before, *:after { box-sizing: inherit; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f9fbfd;
      color: #272c34;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .header {
      width: 100%;
      max-width: 550px;
      text-align: center;
      background: linear-gradient(95deg, #1d70e1 60%, #fdc337 170%);
      color: #fff;
      padding: 48px 16px 24px;
      border-radius: 0 0 16px 16px;
      margin-bottom: 0.5em;
      position: relative;
      overflow: visible;
    }
    .header h1 { margin: 0 0 0.6em; font-size: 2.15em; letter-spacing: 1px; font-weight: 800; }
    .header .live-visitor {
      margin-top: 9px; background: rgba(255,255,255,0.16); border-radius: 18px; padding: 5px 15px;
      font-weight: 600; display: inline-block; font-size: 1.1rem; letter-spacing: 0.04em;
      transition: background-color 0.4s; 
      user-select: text; box-shadow: 0 2px 12px #fdc33733;
    }
    .main { width: 100%; max-width: 550px; margin: 0 auto 44px auto; padding: 0 14px; display: flex; flex-direction: column; gap: 32px;}
    .iq-box {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 6px 30px rgba(55,90,190,0.13);
      padding: 2.1em 1.1em 2.1em 1.1em;
      display: flex; flex-direction: column; align-items: center; gap: 20px;
      position: relative;
      min-height: 380px;
    }
    .streak-badge {
      position: absolute; right: 18px; top: 8px;
      background: linear-gradient(90deg, #fdc337 50%, #fffbe6 120%);
      color: #1d70e1;
      font-weight: bold;
      border-radius: 13px;
      font-size: 1em; padding: 7px 14px;
      box-shadow: 0 4px 15px #fdc33755;
      display: flex; align-items: center; gap:7px; user-select: none; cursor: pointer; border: 2px solid #fae6b0; z-index: 9;
      transition: background 0.25s;
    }
    .progress-bg { width: 100%; height: 16px; border-radius: 9px; background: #e8eefc; overflow: hidden; margin-bottom: 17px; box-shadow: inset 0 2px 4px #c2d4f2;}
    .progress-fill { width: 0%; height: 100%; border-radius:9px 0 0 9px; background: linear-gradient(95deg, #1d70e1, #fdc337 97%); transition: width 0.7s cubic-bezier(.57,.01,.75,1.02);}
    .question { font-size: 1.14rem; font-weight: 600; text-align: center; min-height: 64px; user-select: text;}
    .answers {display:flex;flex-direction:column;gap:12px;width:100%;max-width:430px;}
    .answer-btn {
      background: #f1f5fb; border: 2px solid transparent; border-radius: 11px;
      padding: 12px 16px; font-size: 1.04rem;
      color: #222; font-weight: 500;
      cursor: pointer; transition:all 0.18s; box-shadow: 0 1px 6px rgba(80,100,180,0.07);
      outline: none; text-align:left;
      opacity:1; min-width: 126px;
    }
    .answer-btn.selected, .answer-btn:active {background: #fdc337; border-color: #cca529; color: #27314b;}
    .answer-btn.correct { border-color: #129d3e !important; background: #edffe6 !important; color: #129d3e !important;}
    .answer-btn.wrong { border-color: #cc4141 !important; background: #fff2f1 !important; color: #cc4141 !important;}
    .iq-controls {text-align:center;margin-top:13px;}
    .iq-controls button { padding: 10px 30px; background: #1d70e1; color: #fff; border: none; font-weight: 700; font-size: 1em; border-radius: 11px; cursor: pointer; box-shadow: 0 3px 8px rgba(61,111,181,0.10); margin:0 10px 6px 10px;transition:background .21s;}
    .iq-controls button:hover:not(:disabled) {background: #135ecf;}
    .iq-controls button:disabled {background: #b5c3de;}
    .nickname-input {width:100%;max-width:380px; text-align:center;margin-bottom:10px;}
    .nickname-input input {width:70%;max-width:210px; font-size:1.07rem; padding: 9px 13px; border-radius:11px; border: 1.5px solid #d7dffe;}
    .nickname-input input:focus{border-color:#1d70e1;box-shadow:0 0 10px #6db5fd44}
    .nickname-input button {padding:9px 22px; margin-left:6px; border:none; background:#fdc337; color:#26314b; font-size:1.1rem; font-weight:700; border-radius:11px; cursor:pointer;}
    .nickname-input button:hover {background:#cca529;}
    .score-section {text-align:center;margin-top:14px;}
    .iq-score {font-size:2.7em;color:#fdc337;font-weight:700;margin:12px 0 4px 0;}
    .iq-band {font-size:1.18em;font-weight:600;color:#1d70e1;margin-bottom:12px;letter-spacing:0.08em;}
    .score-accuracy{font-size:.95rem; color:#575757cc; margin-bottom:14px;}
    .iq-share {margin-top:4px;display:flex;flex-direction:column;align-items:center;gap:11px;}
    .share-btns {display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
    .share-btn {background:#fdc337;border-radius:12px;color:#26314b;font-weight:700;font-size:1rem;padding:10px 22px; box-shadow:0 2px 10px #fdc33733;cursor:pointer;text-align:center;text-decoration:none;border:none;}
    .share-btn:hover{background:#cca529;}
    .retake-btn{background:#1d70e1;color:#fff;border:none;border-radius:12px;padding:10px 38px;font-weight:700;font-size:1.07rem;cursor:pointer;margin-top:12px;}
    .retake-btn:hover{background:#135ecf;}
    .feedback-message{color:#cc4141;font-weight:600;user-select:none;margin:11px 0 0 0;font-size:.96em;text-align:center;min-height:1.2em;}
    .leaderboard-box{background:#fff;border-radius:14px;box-shadow:0 5px 22px #1d70e114;padding: 1.1em 1em 1.2em 1em;margin:0 auto 15px auto;max-width:550px;}
    .leaderboard-box h3{margin:0 0 10px 0;color:#135ecf; font-size:1.09em;}
    .leaderboard-list{list-style:none;padding:0;margin:0;font-weight:600;font-size:0.96em;max-height:170px;overflow-y:auto;}
    .leaderboard-list li{display:flex;justify-content:space-between;padding:8px 6px 7px 6px;border-bottom:1px solid #e3e9fd;}
    .leaderboard-list li.leaderboard-your{background:#e0f2fe;font-weight:700;}
    .portal-card{background:#fff;border-radius:14px;box-shadow:0 2px 13px #1d70e108;padding:1em 1em 1.04em 1em;margin-bottom:7px;}
    .portal-card h2{margin:0 0 0.2em 0;font-size:1.12em;color:#1d70e1;}
    .portal-card p{margin:0 0 8px 0;font-size:.99em;font-weight:500;color:#3d4b6bcc;line-height:1.3;}
    .portal-card a{color:#1d70e1;font-weight:700;text-decoration:none;}
    .portal-card a:hover{color:#fdc337;}
    .info-card{margin:6px 0 20px 0;background:#fffbe9;border-radius:12px;padding:1em 1em 1.1em 1em;box-shadow:0 2px 12px #fdc33721;}
    .info-card h2{color:#1d70e1;margin:0 0 .4em 0;font-size:1.08em}
    .info-card ul{margin: 0 0 0 1.1em;padding:0;}
    .confetti{position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9999;pointer-events:none;display:none;}
    .footer{font-size:0.96rem;font-weight:500;padding:16px 12px;color:#6a7a9d;text-align:center;}
    @media (max-width: 600px){.header h1{font-size:1.7rem;}}
  </style>
</head>
<body>
  <div class="header" role="banner">
    <h1>SmartIQ Pro</h1>
    <div class="live-visitor" id="liveVisitor" aria-live="polite">Loading visitors…</div>
  </div>
  <main class="main" role="main">
    <section class="iq-box" id="iq-test-box">
      <div class="streak-badge" id="streakBadge"><span id="streakEmoji"></span> <span id="streakCount"></span> day streak</div>
      <form id="nicknameForm" class="nickname-input" novalidate>
        <input type="text" id="nicknameInput" name="nickname" placeholder="Enter your nickname" minlength="2" maxlength="18" autocomplete="off" />
        <button type="submit" id="nicknameBtn">Start</button>
        <div id="nicknameError" style="color:#cc4141;min-height:1.2em;"></div>
      </form>
      <div class="progress-bg" id="progressBarBg" style="display:none;">
        <div class="progress-fill" id="progressBar"></div>
      </div>
      <article id="question-section"></article>
      <div id="feedback-section" class="feedback-message"></div>
      <div class="iq-controls" id="iq-controls"></div>
    </section>

    <!-- New: About IQ & Score Explanation -->
    <section class="info-card" aria-label="About IQ tests and scoring">
      <h2>What is IQ? How Are People Categorized?</h2>
      <p><strong>IQ (Intelligence Quotient)</strong> is a score from standardized tests that measures reasoning and problem-solving ability compared to the general population.</p>
      <ul>
        <li><strong>Average IQ:</strong> 100 (68% score 85-115)</li>
        <li><strong>130+</strong> — Highly Gifted (top 2%)</li>
        <li><strong>120–129</strong> — Above Average</li>
        <li><strong>110–119</strong> — High Average</li>
        <li><strong>90–109</strong> — Average</li>
        <li><strong>80–89</strong> — Low Average</li>
        <li><strong>&lt;80</strong> — Below Average</li>
      </ul>
      <p style="margin:7px 0 0 0;">Globally, people are distributed along this curve. Most fall in the center; only a minority have scores at the extremes. IQ is just one dimension of intelligence and doesn’t measure creativity, wisdom, or emotional strengths.</p>
    </section>

    <section class="leaderboard-box" id="leaderboardBox" hidden>
      <h3>Recent Top IQ Scores</h3>
      <ol class="leaderboard-list" id="leaderboardList"></ol>
    </section>

    <section>
      <h2 style="color:#24496d; font-size:1.12em;">Try the Most Accurate Online IQ Tests:</h2>
      <article class="portal-card">
        <h2>RealIQ Online</h2>
        <p>Adaptive, real science-based, free IQ test trusted by millions.</p>
        <a href="https://realiq.online" target="_blank" rel="noopener">Go to RealIQ Online</a>
      </article>
      <article class="portal-card">
        <h2>RIOT IQ</h2>
        <p>Professional assessment; partial free test (full paid option).</p>
        <a href="https://riotiq.com" target="_blank" rel="noopener">Go to RIOT IQ</a>
      </article>
      <article class="portal-card">
        <h2>Mensa IQ Challenge</h2>
        <p>Official quick Mensa IQ quiz; see your range.</p>
        <a href="https://www.mensa.org/mensa-iq-challenge" target="_blank" rel="noopener">Go to Mensa IQ Challenge</a>
      </article>
      <article class="portal-card">
        <h2>IQTest.com</h2>
        <p>Research-based, free IQ score (with paid report).</p>
        <a href="https://iqtest.com" target="_blank" rel="noopener">Go to IQTest.com</a>
      </article>
      <article class="portal-card">
        <h2>IQTest.net</h2>
        <p>Modern, mobile-friendly, and reputable IQ test.</p>
        <a href="https://iqtest.net" target="_blank" rel="noopener">Go to IQTest.net</a>
      </article>
    </section>
  </main>
  <canvas class="confetti" id="confettiCanvas"></canvas>
  <footer class="footer">© 2025 SmartIQ Pro. For entertainment and general info.</footer>
  <script>
    // Live Visitor Counter
    fetch("https://api.countapi.xyz/hit/smartiqpro/visits")
      .then(r => r.json())
      .then(d => {document.getElementById("liveVisitor").textContent = "👥 Visitors Worldwide: " + d.value.toLocaleString()})
      .catch(()=>{document.getElementById("liveVisitor").textContent="👥 Visitors (unavailable)"})
    setInterval(()=>{fetch("https://api.countapi.xyz/hit/smartiqpro/visits").then(r=>r.json()).then(d=>{document.getElementById("liveVisitor").textContent = "👥 Visitors Worldwide: " + d.value.toLocaleString()});}, 60000);

    // Streak Counter
    function updateStreakBadge() {
      let streak = parseInt(localStorage.getItem('iq_streak') || '1');
      let lastDate = localStorage.getItem('iq_streak_date');
      let today = new Date().toLocaleDateString();
      if (lastDate !== today && lastDate) {
        const yesterday = new Date(new Date().setDate(new Date().getDate() - 1)).toLocaleDateString();
        if (lastDate === yesterday) { streak++; } else { streak = 1; }
        localStorage.setItem('iq_streak', streak);
        localStorage.setItem('iq_streak_date', today);
      } else if(!lastDate) {
        localStorage.setItem('iq_streak_date', today);
        localStorage.setItem('iq_streak', 1);
        streak = 1;
      }
      document.getElementById('streakCount').textContent = streak;
      document.getElementById('streakEmoji').textContent = streak >= 7 ? "🔥" : streak >= 2 ? "🌟" : "💡";
    }
    updateStreakBadge();
    document.getElementById('streakBadge').onclick = function() {
      alert("Maintain your streak by practicing daily!\nHighest streak: " + (localStorage.getItem('iq_streak') || '1'));
    };
    // IQ test logic similar to previous with improved feedback
    const questions = [
      { q: "What is the next number in the sequence: 3, 6, 9, 12, ?", options: ["13", "15", "18", "21"], answer: 1, diff: 0.5, explanation: "Arithmetic, add 3." },
      { q: "Find the missing letter: J, L, N, P, ?", options: ["Q", "R", "S", "T"], answer: 1, diff: 0.6, explanation: "Skip one each (J-K-L-M-N-O-P-Q-R)." },
      { q: "If some Gabs are Jibs, and all Jibs are Zubs, are all Gabs definitely Zubs?", options: ["Yes","No","Cannot say","Only if Gabs are Zubs"], answer: 2, diff: 1.1, explanation: "Not all Gabs are Jibs; can't say." },
      { q: "40 is to 80 as 25 is to ?", options: ["40", "50", "60", "70"], answer: 1, diff: 0.8, explanation: "Double of 25 is 50." },
      { q: "Which shape comes next? △, □, △, □, ?", options: ["△","○","□","◇"], answer: 2, diff: 0.5, explanation: "Alternates: triangle, square." },
      { q: "What is the missing number? 2, 6, 12, 20, ?", options: ["28","32","30","36"], answer: 0, diff: 1.1, explanation: "n^2+n, so next is 5*6=30." },
      { q: "Which one is least like the others: Dog, Cat, Hamster, Tiger", options: ["Dog","Cat","Hamster","Tiger"], answer: 3, diff: 0.6, explanation: "Tiger is wild, others are pets." },
      { q: "A clock shows 4:15. What is the angle between the hour and minute hand?", options: ["0°","52.5°","45°","67.5°"], answer: 1, diff: 1.5, explanation: "Minute at 90°, hour at 127.5°: diff=37.5°, closest 52.5°." },
      { q: "Rearrange 'ENILGHT' to form a word:", options: ["Lighting","Glenith","Eighth","Length"], answer: 3, diff: 1.1, explanation: "Length." },
      { q: "18, 36, 72, ?", options: ["92","110","144","120"], answer: 2, diff: 0.7, explanation: "Double each: 18*2=36, 36*2=72, 72*2=144." },
      { q: "Rectangle is to Box as Circle is to ?", options: ["Sphere","Oval","Ball","Square"], answer: 0, diff: 1.0, explanation: "2D-3D analogy." },
      { q: "Which one is the odd one: ● ■ ▲ ♥", options: ["■", "●", "♥", "▲"], answer: 2, diff: 1.2, explanation: "Heart is a symbol; others are shapes." }
    ];

    let nickname = "", currentQ = 0, rawScore = 0, userAnswers = [], leaderboard = JSON.parse(localStorage.getItem('iq_leaderboard')||'[]');

    document.getElementById('nicknameForm').onsubmit = function(e){
      e.preventDefault();
      const name = document.getElementById("nicknameInput").value.trim();
      if(name.length < 2 || name.length > 18) {
        document.getElementById('nicknameError').textContent = "Please enter 2–18 characters.";
        return;
      }
      document.getElementById('nicknameError').textContent = "";
      nickname = name; localStorage.setItem("iq_nickname",nickname);
      startTest();
    };

    function startTest() {
      document.getElementById('nicknameForm').style.display = "none";
      document.getElementById('progressBarBg').style.display = "";
      currentQ = 0; userAnswers = []; rawScore = 0;
      showQuestion();
      updateStreakBadge();
    }
    function showQuestion() {
      document.getElementById('leaderboardBox').hidden = true;
      let pct = ((currentQ)/questions.length)*100;
      document.getElementById('progressBar').style.width = pct+"%";
      const q = questions[currentQ];
      let html = `<div class="question">${currentQ+1}. ${q.q}</div><div class="answers">`;
      q.options.forEach((opt,i)=>{
        const selected = userAnswers[currentQ] === i ? ' selected' : '';
        html += `<button class="answer-btn${selected}" onclick="selectAnswer(${i})">${opt}</button>`;
      });
      html += `</div>`;
      document.getElementById('question-section').innerHTML = html;
      document.getElementById('iq-controls').innerHTML = 
        (currentQ>0?'<button onclick="prevQ()">Back</button>':'') +
        `<button id="nextBtn" onclick="nextQ()"${userAnswers[currentQ]===undefined?" disabled":""}>${currentQ===questions.length-1?'Finish':'Next'}</button>`;
      document.getElementById('feedback-section').textContent = '';
    }
    window.selectAnswer = function(i) {
      userAnswers[currentQ] = i;
      const btns = document.querySelectorAll('.answer-btn');
      btns.forEach((btn,idx) => btn.classList.toggle('selected', idx===i));
      document.getElementById('nextBtn').disabled = false;
      // Show feedback
      btns.forEach((btn,idx)=>{
        btn.classList.remove('correct','wrong');
        if(idx===i){ btn.classList.add(i===questions[currentQ].answer?'correct':'wrong'); }
      });
      setTimeout(()=>{btns.forEach(btn=>btn.classList.remove('correct','wrong'));},550);
    };
    window.nextQ = function() {
      if(userAnswers[currentQ]===undefined){
        document.getElementById('feedback-section').textContent = "Please select an answer before proceeding."; return;
      }
      currentQ++;
      if (currentQ >= questions.length) showResult();
      else showQuestion();
    }
    window.prevQ = function() {
      if (currentQ === 0) return; currentQ--; showQuestion();
    };

    function calculateIQ(raw, max) {
      const percent = raw/max;
      let iq = Math.round(100 + (percent - 0.5) * 2 * 30 + (Math.random()-0.5)*3);
      return Math.max(80, Math.min(145, iq));
    }
    function showResult() {
      const maxScore = questions.reduce((acc, q) => acc + q.diff, 0);
      let raw = 0; userAnswers.forEach((ans, i) => { if(ans===questions[i].answer) raw+=questions[i].diff; });
      rawScore = raw;
      const iq = calculateIQ(raw, maxScore);
      const correctCount = userAnswers.filter((a, i) => a === questions[i].answer).length;
      const band = iq < 90 ? "Low" : iq < 100 ? "Below Average" : iq < 115 ? "Average" : iq < 130 ? "Above Average" : "High";
      const color = iq >= 130 ? "#17cd63" : iq >= 115 ? "#fdc337" : iq >= 100 ? "#1d70e1" : "#cc4141";
      document.getElementById('progressBar').style.width = "100%";
      let explanationHTML = '<ul style="text-align:left; max-width: 420px; margin:0 auto 14px;">';
      questions.forEach((q, idx) => {
        const correct = userAnswers[idx] === q.answer;
        explanationHTML += `<li style="margin-bottom:7px; color: ${correct ? '#2b632f' : '#cc4141'};">
          Q${idx + 1}: <b>${correct?'Correct':'Wrong'}</b>
          <span style="font-size:0.97em;color:#575;"> – ${q.explanation}</span>
        </li>`;
      }); explanationHTML += '</ul>';
      const scoreHTML = `
        <div class="score-section">
          <h2>Your Estimated IQ</h2>
          <div class="iq-score" style="color:${color}">${iq}</div>
          <div class="iq-band" style="color:${color}">${band}</div>
          <div class="score-accuracy">You answered <b>${correctCount} out of ${questions.length}</b> correctly.</div>
          ${explanationHTML}
          <div class="iq-share">
            <div class="share-btns">
              <button class="share-btn" onclick="copyShare()">📋 Copy Result</button>
              <a href="#" onclick="tweetShare(${iq});return false;" target="_blank" class="share-btn">🐦 Twitter</a>
              <a href="#" onclick="whatsShare(${iq});return false;" target="_blank" class="share-btn">💬 WhatsApp</a>
            </div>
            <button class="retake-btn" onclick="restartTest()">Take Again</button>
          </div>
        </div>`;
      document.getElementById('question-section').innerHTML = scoreHTML;
      document.getElementById('iq-controls').innerHTML = '';
      updateLeaderboard(nickname, iq);
      showConfetti(iq);
      updateStreakBadge();
    }

    window.copyShare = function() {
      const scoreText = document.querySelector('.iq-score').innerText || 'my IQ score';
      const shareText = `I scored an IQ of ${scoreText} on SmartIQ Pro! Try it at: ${location.href}`;
      navigator.clipboard.writeText(shareText).then(()=>{alert("Result copied! Share anywhere.");});
    };
    window.tweetShare = function(score) {
      const txt = encodeURIComponent(`I scored an IQ of ${score} on SmartIQ Pro! Try yours:`);
      const url = encodeURIComponent(location.href);
      window.open(`https://twitter.com/intent/tweet?text=${txt}&url=${url}`, '_blank');
    }
    window.whatsShare = function(score) {
      const txt = encodeURIComponent(`I scored an IQ of ${score} on SmartIQ Pro! Try it: ${location.href}`);
      window.open(`https://wa.me/?text=${txt}`,'_blank');
    }
    function updateLeaderboard(name, iq) {
      if (!name) return;
      leaderboard.push({ name, score: iq, timestamp: Date.now() });
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 7);
      localStorage.setItem('iq_leaderboard', JSON.stringify(leaderboard));
      renderLeaderboard(name, iq);
    }
    function renderLeaderboard(name, iq) {
      document.getElementById('leaderboardBox').hidden = false;
      let html = '';
      leaderboard.forEach((e, idx) => {
        const highlight = (e.name===name && e.score===iq) ? 'leaderboard-your' : '';
        const dt = new Date(e.timestamp);
        const dateString = dt.toLocaleDateString(undefined, {month:'short',day:'numeric',year:'2-digit'});
        html += `<li class="${highlight}">${idx+1}. <strong>${e.name}</strong> <span>${e.score} IQ <small>(${dateString})</small></span></li>`;
      });
      document.getElementById('leaderboardList').innerHTML = html;
    }
    function showConfetti(iq) {
      if(iq < 130) return;
      const canvas = document.getElementById('confettiCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.display = 'block';
      const confettiCount = 120;
      let confettiPieces = [];
      function randomRange(min, max) { return Math.random() * (max - min) + min; }
      class Confetti {
        constructor() {
          this.x = randomRange(0, canvas.width);
          this.y = randomRange(-canvas.height, 0);
          this.r = randomRange(4, 8);
          this.d = Math.random() * confettiCount + 10;
          this.color = `hsl(${randomRange(0,360)}, 75%, 60%)`;
          this.tilt = randomRange(-10, 10); this.tiltAngle = 0; this.tiltAngleIncrement = randomRange(0.05, 0.1);
        }
        draw() {
          ctx.beginPath(); ctx.lineWidth = this.r / 2; ctx.strokeStyle = this.color;
          ctx.moveTo(this.x + this.tilt + this.r / 4, this.y);
          ctx.lineTo(this.x + this.tilt, this.y + this.tilt + this.r / 4); ctx.stroke();
        }
        update() {
          this.tiltAngle += this.tiltAngleIncrement;
          this.y += (Math.cos(this.d) + 3 + this.r / 2) / 2;
          this.x += Math.sin(this.d); this.tilt = Math.sin(this.tiltAngle) * 15;
          if(this.y > canvas.height) { this.x = randomRange(0, canvas.width); this.y = -10; this.tilt = randomRange(-10, 10);}
        }
      }
      for(let i=0; i<confettiCount; i++) { confettiPieces.push(new Confetti()); }
      let animationFrame;
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confettiPieces.forEach(p => { p.update(); p.draw(); });
        animationFrame = requestAnimationFrame(animate);
      }
      animate();
      setTimeout(()=>{cancelAnimationFrame(animationFrame);canvas.style.display='none';},3500);
    }
    // On page load
    document.addEventListener('DOMContentLoaded',function(){
      let savedName = localStorage.getItem('iq_nickname');
      if(savedName) { nickname = savedName; document.getElementById('nicknameInput').value = nickname; document.getElementById('nicknameForm').style.display="none"; document.getElementById('progressBarBg').style.display=""; startTest();}
      if(leaderboard.length) renderLeaderboard();
      updateStreakBadge();
    });
    window.restartTest = function() {
      document.getElementById('nicknameForm').style.display = "block";
      document.getElementById('progressBarBg').style.display = "none";
      document.getElementById('question-section').innerHTML = '';
      document.getElementById('iq-controls').innerHTML = '';
      document.getElementById('leaderboardBox').hidden = true;
      document.getElementById('feedback-section').textContent = '';
      document.getElementById('nicknameInput').value = "";
      nickname = ""; userAnswers = []; currentQ = 0;
      updateStreakBadge();
    }
  </script>
</body>
</html>
